/*====================================================================================================*/
/*====================================================================================================*/
#include "drivers\stm32f4_system.h"
#include "algorithms\moveAve.h"
/*====================================================================================================*/
/*====================================================================================================*
**函數 : MoveAve_SMA
**功能 : Simple Moving Average
**輸入 : newData, moveAveFIFO, fifoLens, windowLens
**輸出 : aveData
**使用 : MoveAve_SMA(newData, moveAveFIFO, fifoLens, windowLens);
**====================================================================================================*/
/*====================================================================================================*/
float MoveAve_SMA( int16_t newData, int16_t *moveAveFIFO, uint16_t fifoLens, uint16_t windowLens )
{
  uint16_t p_front = moveAveFIFO[0];
  uint16_t p_rear  = ((p_front - windowLens + fifoLens) % fifoLens) + 1;

  int32_t sumData = 0;

  moveAveFIFO[p_front] = newData;
  if(p_front > p_rear) {
    for(uint16_t i = p_front; i > p_rear - 1; i--)
      sumData = sumData + moveAveFIFO[i];
  }
  else {
    for(uint16_t i = p_front; i > 0; i--)
      sumData = sumData + moveAveFIFO[i];
    for(uint16_t i = fifoLens; i > p_rear - 1; i--)
      sumData = sumData + moveAveFIFO[i];
  }
  moveAveFIFO[0] = (p_front % fifoLens) + 1;

  return (sumData / (float)windowLens);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : MoveAve_WMA
**功能 : Weighted Moving Average
**輸入 : newData, moveAveFIFO, weighted, fifoLens, windowLens
**輸出 : aveData
**使用 : MoveAve_WMA(newData, moveAveFIFO, weighted, fifoLens, windowLens);
**====================================================================================================*/
/*====================================================================================================*/
float MoveAve_WMA( int16_t newData, int16_t *moveAveFIFO, int16_t *weighted, uint16_t fifoLens, uint16_t windowLens )
{
  uint8_t j = 0;
  uint16_t p_front = moveAveFIFO[0];
  uint16_t p_rear  = ((p_front - windowLens + fifoLens) % fifoLens) + 1;

  int32_t sumData = 0;

  moveAveFIFO[p_front] = newData;
  if(p_front > p_rear) {
    for(uint16_t i = p_front; i > p_rear - 1; i--)
      sumData = sumData + moveAveFIFO[i] * weighted[++j];
  }
  else {
    for(uint16_t i = p_front; i > 0; i--)
      sumData = sumData + moveAveFIFO[i] * weighted[++j];
    for(uint16_t i = fifoLens; i > p_rear - 1; i--)
      sumData = sumData + moveAveFIFO[i] * weighted[++j];
  }
  moveAveFIFO[0] = (p_front % fifoLens) + 1;

  return (sumData / (float)weighted[j]);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : MoveAve_EMA
**功能 : Exponential Moving Average
**輸入 : NewData, MoveAve_FIFO, SampleLen
**輸出 : AveData
**使用 : MoveAve_EMA(NewData, MoveAve_FIFO, SampleLen);
**====================================================================================================*/
/*====================================================================================================*/

/*====================================================================================================*/
/*====================================================================================================*/
